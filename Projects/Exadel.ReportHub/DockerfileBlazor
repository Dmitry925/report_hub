FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /app

COPY ["Projects/Exadel.ReportHub/Exadel.ReportHub.Blazor/Exadel.ReportHub.Blazor.csproj", "Exadel.ReportHub.Blazor/"]
COPY ["Projects/Exadel.ReportHub/Directory.Build.props", "./"]
COPY ["Projects/Exadel.ReportHub/Exadel.ReportHub.ruleset", "./"]

RUN dotnet restore "Exadel.ReportHub.Host/Exadel.ReportHub.Blazor.csproj"


COPY ["Projects/Exadel.ReportHub/", "./"]

RUN dotnet publish "Exadel.ReportHub.Blazor/Exadel.ReportHub.Blazor.csproj" -c Release -o /app/publish


FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS final
WORKDIR /app

COPY --from=build /app/publish .


ENV ASPNETCORE_ENVIRONMENT=Production
ENV PORT=5003
ENV ASPNETCORE_URLS=http://+:${PORT}

ENTRYPOINT ["dotnet", "Exadel.ReportHub.Blazor.dll"]
